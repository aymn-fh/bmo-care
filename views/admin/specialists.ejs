<%- include('../partials/layout-start', { title: __('specialists'), activePage: 'specialists' }) %>

<div class="page-container-clean">
    <div class="section-header-clean" style="margin-bottom: 2rem; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
        <h2 style="font-size: 1.5rem; color: var(--text-primary); margin: 0; display: flex; align-items: center; gap: 0.5rem;">
            <i class="fas fa-user-md" style="color: #3b82f6;"></i>
            <%= __('specialists') %>
        </h2>
        <div style="display: flex; gap: 10px;">
            <a href="/export/specialists?format=pdf" class="btn btn-outline" style="border-radius: 8px; display: flex; align-items: center; gap: 0.5rem;" title="<%= __('export') %>">
                <i class="fas fa-file-pdf" style="color: #ef4444;"></i>
                <%= __('export') %>
            </a>
            <a href="/admin/specialists/create" class="btn btn-primary" style="border-radius: 8px; display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-plus"></i>
                <%= __('createSpecialist') %>
            </a>
        </div>
    </div>

    <style>
        .dropdown-content.show {
            display: block !important;
        }

        .dropdown-content a:hover {
            background-color: #f1f1f1;
        }
        
        /* Clean search input overrides */
        .clean-input {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            background: var(--bg-card);
            color: var(--text-primary);
            transition: all 0.2s;
        }
        
        .clean-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
    </style>

    <!-- Search Box -->
    <div class="search-container glass" style="margin-bottom: 1.5rem; padding: 1.5rem; border-radius: 16px;">
        <form action="/admin/specialists" method="GET" style="display: flex; gap: 10px; flex-wrap: wrap;">
            <input type="text" name="search" class="clean-input" placeholder="<%= __('staffIdSearchPlaceholder') %>"
                value="<%= searchQuery || '' %>" style="flex: 1; min-width: 200px;">
            <button type="submit" class="btn btn-primary" style="border-radius: 10px; padding: 0 1.5rem;">
                <i class="fas fa-search" style="margin-left: 0.5rem;"></i>
                <%= __('search') %>
            </button>
            <% if (searchQuery) { %>
                <a href="/admin/specialists" class="btn btn-outline" style="border-radius: 10px; display: flex; align-items: center;">
                    <i class="fas fa-times" style="margin-left: 0.5rem;"></i>
                    <%= __('cancel') %>
                </a>
            <% } %>
        </form>
    </div>

    <!-- Advanced Filters -->
    <div style="margin-bottom: 1.5rem;">
        <%- include('../partials/advanced-filters') %>
    </div>

    <div class="table-responsive glass" style="border-radius: 16px; padding: 1.5rem;">
        <table class="clean-table" style="width: 100%; border-collapse: separate; border-spacing: 0 0.5rem;">
            <thead>
                <tr>
                    <th style="width: 40px; text-align: center;">
                        <input type="checkbox" id="selectAll" onclick="toggleSelectAll(this)" style="cursor: pointer;">
                    </th>
                    <th style="padding: 1rem; color: var(--text-secondary); font-weight: 600;"><%= __('staffId') %></th>
                    <th style="padding: 1rem; color: var(--text-secondary); font-weight: 600;"><%= __('name') %></th>
                    <th style="padding: 1rem; color: var(--text-secondary); font-weight: 600;"><%= __('email') %></th>
                    <th style="padding: 1rem; color: var(--text-secondary); font-weight: 600;"><%= __('specialization') %></th>
                    <th style="padding: 1rem; color: var(--text-secondary); font-weight: 600;"><%= __('parents') %></th>
                    <th style="padding: 1rem; color: var(--text-secondary); font-weight: 600;"><%= __('children') %></th>
                    <th style="padding: 1rem; color: var(--text-secondary); font-weight: 600;"><%= __('actions') %></th>
                </tr>
            </thead>
            <tbody>
                <% if (specialists && specialists.length > 0) { %>
                    <% specialists.forEach(function(specialist) { %>
                        <tr style="background: var(--bg-body); transition: transform 0.2s;">
                            <td style="padding: 1rem; border-radius: 8px 0 0 8px; text-align: center;">
                                <input type="checkbox" class="select-item" value="<%= specialist._id %>"
                                    onchange="updateBulkActions()" style="cursor: pointer;">
                            </td>
                            <td style="padding: 1rem;">
                                <span class="badge badge-info" style="background: #e0f2fe; color: #0284c7; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem;">
                                    <%= specialist.staffId || 'N/A' %>
                                </span>
                            </td>
                            <td style="padding: 1rem;">
                                <div class="cell-with-icon" style="display: flex; align-items: center; gap: 1rem;">
                                    <div class="avatar-circle-small" style="width: 40px; height: 40px; border-radius: 50%; overflow: hidden; background: #f1f5f9; flex-shrink: 0;">
                                        <% if (specialist.profilePhoto) { %>
                                            <img src="<%= uploadUrl(specialist.profilePhoto) %>" alt="<%= specialist.name %>" style="width: 100%; height: 100%; object-fit: cover;">
                                        <% } else { %>
                                            <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: #94a3b8;">
                                                <i class="fas fa-user-md"></i>
                                            </div>
                                        <% } %>
                                    </div>
                                    <span style="font-weight: 600; color: var(--text-primary);">
                                        <%= specialist.name %>
                                    </span>
                                </div>
                            </td>
                            <td style="padding: 1rem; color: var(--text-secondary);">
                                <%= specialist.email %>
                            </td>
                            <td style="padding: 1rem; color: var(--text-secondary);">
                                <%= specialist.specialization || '-' %>
                            </td>
                            <td style="padding: 1rem;">
                                <span class="badge" style="background: #f0f9ff; color: #0369a1; padding: 4px 10px; border-radius: 6px;">
                                    <%= specialist.linkedParents ? specialist.linkedParents.length : 0 %>
                                </span>
                            </td>
                            <td style="padding: 1rem;">
                                <span class="badge" style="background: #fffbeb; color: #b45309; padding: 4px 10px; border-radius: 6px;">
                                    <%= specialist.assignedChildren ? specialist.assignedChildren.length : 0 %>
                                </span>
                            </td>
                            <td style="padding: 1rem; border-radius: 0 8px 8px 0;">
                                <div class="action-buttons" style="display: flex; gap: 0.5rem; justify-content: flex-start;">
                                    <a href="/admin/specialists/<%= specialist._id %>"
                                        class="btn btn-sm" style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 8px; border: 1px solid var(--border-color); color: #3b82f6;" title="<%= __('view') %>">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <form action="/admin/specialists/<%= specialist._id %>/delete" method="POST"
                                        class="inline"
                                        onsubmit="return confirm(`<%= __('confirmDelete') || 'هل أنت متأكد من الحذف؟' %>`)">
                                        <button type="submit" class="btn btn-sm" style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 8px; border: 1px solid #fee2e2; color: #ef4444; background: transparent; cursor: pointer;"
                                            title="<%= __('delete') %>">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        <% }); %>
                    <% } else { %>
                        <tr>
                            <td colspan="8" class="text-center text-muted" style="padding: 3rem; text-align: center;">
                                <div style="display: flex; flex-direction: column; align-items: center; gap: 1rem; color: var(--text-secondary);">
                                    <i class="fas fa-search" style="font-size: 2rem; opacity: 0.5;"></i>
                                    <%= __('noData') %>
                                </div>
                            </td>
                        </tr>
                    <% } %>
            </tbody>
        </table>
    </div>
    
    <%- include('../partials/bulk-actions', { entityType: 'specialists' }) %>
</div>

<%- include('../partials/layout-end') %>